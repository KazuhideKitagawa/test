# ワークフローの名前
name: '🎨 Draw.io -> SVG 自動変換'

# ワークフローが実行されるトリガーを定義
on:
  push:
    # どのブランチでも、.drawioファイルが変更されたら実行
    paths:
      - '**.drawio'

# 実行する一連のタスク（ジョブ）を定義
jobs:
  export:
    # ubuntuの最新版環境で実行
    runs-on: ubuntu-latest

    # 実行するステップを定義
    steps:
      # --- ステップ1: リポジトリのコードをチェックアウト ---
      - name: '📂 リポジトリをチェックアウト'
        uses: actions/checkout@v4
        with:
          fetch-depth: 

      # --- ステップ2: Draw.ioファイルをSVGに変換 ---
      - name: '🖌️ Draw.ioファイルをSVGにエクスポート'
        # ★★★ ここを v4 に修正しました ★★★
        uses: rlespinasse/drawio-export-action@v2
        with:
          # リポジトリ内のすべての.drawioファイルを対象にする
          path: '**/*.drawio'
          
          # 出力するフォーマット
          format: 'svg'
          
          # output オプションは指定しない（元ファイルと同じ場所に生成）
          
          # SVGの背景を透過させる場合は true
          svg-transparent: true

      # --- ステップ3: 生成されたファイルをリポジトリにコミット ---
      - name: '💾 変更をコミット'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # コミットメッセージ
          commit_message: 'docs(diagrams): Draw.ioからSVGを自動生成'
          
          # コミット対象のファイルパターン
          file_pattern: '**/*.svg'
